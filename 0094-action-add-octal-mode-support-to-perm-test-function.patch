From f3946943a020d0a7d93bf876b5ee3d48794e2097 Mon Sep 17 00:00:00 2001
From: Phillip Lougher <phillip@squashfs.org.uk>
Date: Mon, 8 Sep 2014 03:09:35 +0100
Subject: [PATCH 094/120] action: add octal mode support to perm test function

Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>
---
 squashfs-tools/action.c     | 12 +++++++++---
 squashfs-tools/mksquashfs.c |  2 +-
 2 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/squashfs-tools/action.c b/squashfs-tools/action.c
index 8d596ac..4e64a33 100644
--- a/squashfs-tools/action.c
+++ b/squashfs-tools/action.c
@@ -1184,7 +1184,8 @@ static void guid_action(struct action *action, struct dir_ent *dir_ent)
 /*
  * Mode specific action code
  */
-static int parse_octal_mode_args(int args, char **argv, void **data)
+static int parse_octal_mode_args(int args, char **argv,
+			void **data)
 {
 	int n, bytes;
 	unsigned int mode;
@@ -3058,8 +3059,13 @@ static int parse_perm_args(struct test_entry *test, struct atom *atom)
 		break;
 	}
 
-	for(i = 0; i < atom->args && res; i++, arg = atom->argv[i])
-		res = parse_sym_mode_arg(arg, &head, &cur);
+	/* try to parse as an octal number */
+	res = parse_octal_mode_args(atom->args, atom->argv, (void **) &head);
+	if(res == -1) {
+		/* parse as sym mode argument */
+		for(i = 0; i < atom->args && res; i++, arg = atom->argv[i])
+			res = parse_sym_mode_arg(arg, &head, &cur);
+	}
 
 	if (res == 0)
 		goto finish;
diff --git a/squashfs-tools/mksquashfs.c b/squashfs-tools/mksquashfs.c
index 3b2d2e3..6644c98 100644
--- a/squashfs-tools/mksquashfs.c
+++ b/squashfs-tools/mksquashfs.c
@@ -5089,7 +5089,7 @@ void calculate_queue_sizes(int mem, int *readq, int *fragq, int *bwriteq,
 
 
 #define VERSION() \
-	printf("mksquashfs version 4.3-git (2014/09/05)\n");\
+	printf("mksquashfs version 4.3-git (2014/09/07)\n");\
 	printf("copyright (C) 2014 Phillip Lougher "\
 		"<phillip@squashfs.org.uk>\n\n"); \
 	printf("This program is free software; you can redistribute it and/or"\
-- 
2.8.3

