From daa1bcbeb8b9aa3d572caba1fbd3d19cf345824a Mon Sep 17 00:00:00 2001
From: Phillip Lougher <phillip@squashfs.org.uk>
Date: Wed, 27 Aug 2014 05:36:27 +0100
Subject: [PATCH 069/120] action: extend logging to handle log if action TRUE
 and log if action FALSE

Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>
---
 squashfs-tools/action.c |  9 +++++++--
 squashfs-tools/action.h | 11 +++++++++++
 2 files changed, 18 insertions(+), 2 deletions(-)

diff --git a/squashfs-tools/action.c b/squashfs-tools/action.c
index faf3566..6feb616 100644
--- a/squashfs-tools/action.c
+++ b/squashfs-tools/action.c
@@ -768,8 +768,13 @@ static int eval_expr_top(struct action *action, struct action_data *action_data)
 
 		match = eval_expr_log(action->expr, action_data);
 
-		/* Print the evaluated expression log */
-		progressbar_info("%s\n", expr_log(""));
+		/*
+		 * Print the evaluated expression log, if the
+		 * result matches the logging specified
+		 */
+		if((match && (action->verbose & ACTION_LOG_TRUE)) || (!match
+				&& (action->verbose & ACTION_LOG_FALSE)))
+			progressbar_info("%s\n", expr_log(""));
 
 		expr_log_cmnd(LOG_DISABLE);
 
diff --git a/squashfs-tools/action.h b/squashfs-tools/action.h
index 4b6e1f8..1ca2df1 100644
--- a/squashfs-tools/action.h
+++ b/squashfs-tools/action.h
@@ -185,6 +185,17 @@ struct type_entry {
 #define ACTION_ALL 4
 #define ACTION_LNK 5
 
+
+/*
+ * Action logging requested, specified by the various
+ * -action, -true_action, -false_action and -verbose_action
+ * options
+ */
+#define ACTION_LOG_NONE	0
+#define ACTION_LOG_TRUE 1
+#define ACTION_LOG_FALSE 2
+#define ACTION_LOG_VERBOSE ACTION_LOG_TRUE | ACTION_LOG_FALSE
+
 struct action_entry {
 	char *name;
 	int type;
-- 
2.8.3

